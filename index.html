<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleCorp - Gerenciamento de Linhas Telef√¥nicas</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.6.0/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div id="loader" class="loader hidden">Carregando...</div>
    <div class="app">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">‚ò∞</button>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>TeleCorp</h2>
                <p>Gerenciamento de Linhas</p>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" data-page="dashboard" class="menu-link active">
                    <span>üìä</span> Dashboard
                </a></li>
                <li><a href="#" data-page="management" class="menu-link">
                    <span>üìû</span> Gerenciamento
                </a></li>
                <li><a href="#" data-page="reports" class="menu-link">
                    <span>üìã</span> Relat√≥rios
                </a></li>
                <li><a href="#" data-page="settings" class="menu-link">
                    <span>‚öôÔ∏è</span> Configura√ß√µes
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page" id="dashboard-page">
                <header class="page-header">
                    <h1>Dashboard</h1>
                    <div class="header-actions">
                        <div class="connection-status" id="connection-status">
                            <span class="status-indicator" id="status-indicator"></span>
                            <div class="status-details">
                                <span id="status-text">Verificando conex√£o...</span>
                                <small id="status-subtitle">Carregando...</small>
                            </div>
                        </div>
                        <button class="btn btn--outline btn--sm" id="force-reconnect-btn">
                            üîÑ Reconectar
                        </button>
                    </div>
                </header>

                <!-- System Status Panel -->
                <div class="system-status-panel">
                    <div class="status-item">
                        <span class="status-label">Modo de Opera√ß√£o:</span>
                        <span class="status-value" id="operation-mode-display">Online</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">√öltima Sincroniza√ß√£o:</span>
                        <span class="status-value" id="last-sync-display">Nunca</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Total de Registros:</span>
                        <span class="status-value">
                            <span id="local-records">0</span> local / 
                            <span id="remote-records">-</span> remoto
                        </span>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üì±</div>
                        <div class="stat-content">
                            <h3 id="total-lines">-</h3>
                            <p>Total de Linhas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <h3 id="active-lines">-</h3>
                            <p>Linhas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <h3 id="total-cost">-</h3>
                            <p>Custo Total</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè¢</div>
                        <div class="stat-content">
                            <h3 id="total-entities">-</h3>
                            <p>Entidades</p>
                        </div>
                    </div>
                </div>

                <!-- Entity Cards -->
                <section class="section">
                    <h2>Entidades</h2>
                    <div class="entity-grid" id="entity-cards">
                        <!-- Entity cards will be populated here -->
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="section">
                    <h2>An√°lises Visuais</h2>
                    <div class="charts-grid">
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <h3>Distribui√ß√£o por Entidade</h3>
                            <canvas id="entity-chart"></canvas>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <h3>Custos por Entidade</h3>
                            <canvas id="cost-chart"></canvas>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Management Page -->
            <div class="page hidden" id="management-page">
                <header class="page-header">
                    <h1>Gerenciamento de Linhas</h1>
                    <div class="header-actions">
                        <button class="btn btn--primary" id="add-line-btn">
                            ‚ûï Adicionar Linha
                        </button>
                        <button class="btn btn--secondary" id="refresh-lines-btn">
                            üîÑ Atualizar
                        </button>
                    </div>
                </header>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-grid">
                        <div class="form-group">
                            <input type="text" class="form-control" id="search-input" placeholder="Buscar por titular, n√∫mero, plano...">
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="entity-filter">
                                <option value="">Todas as Entidades</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="plan-filter">
                                <option value="">Todos os Planos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="status-filter">
                                <option value="">Todos os Status</option>
                                <option value="ativa">Ativa</option>
                                <option value="inativa">Inativa</option>
                            </select>
                        </div>
                    </div>
                    <div class="filters-summary" id="filters-summary">
                        Mostrando <span id="filtered-count">0</span> de <span id="total-count">0</span> linhas
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Titular</th>
                                <th>N√∫mero</th>
                                <th>Plano</th>
                                <th>Valor</th>
                                <th>Centro de Custo</th>
                                <th>Entidade</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lines-table-body">
                            <!-- Table rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Page -->
            <div class="page hidden" id="reports-page">
                <header class="page-header">
                    <h1>Relat√≥rios</h1>
                    <p>Exporta√ß√£o de dados em PDF e Excel</p>
                </header>

                <div class="reports-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>üìÑ Relat√≥rio PDF Completo</h3>
                            <p>Relat√≥rio detalhado com gr√°ficos, estat√≠sticas e tabela de linhas</p>
                            <div class="report-features">
                                <span class="feature-badge">‚úì Gr√°ficos inclusos</span>
                                <span class="feature-badge">‚úì Estat√≠sticas detalhadas</span>
                                <span class="feature-badge">‚úì Tabela completa</span>
                            </div>
                            <button class="btn btn--primary btn--full-width" id="export-pdf-btn">
                                üìÑ Gerar Relat√≥rio PDF
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__body">
                            <h3>üìä Exporta√ß√£o Excel</h3>
                            <p>Dados estruturados para an√°lise em planilhas</p>
                            <div class="report-features">
                                <span class="feature-badge">‚úì Dados completos</span>
                                <span class="feature-badge">‚úì Formato CSV</span>
                                <span class="feature-badge">‚úì Filtros aplicados</span>
                            </div>
                            <button class="btn btn--secondary btn--full-width" id="export-excel-btn">
                                üìä Exportar para Excel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Filters -->
                <section class="section">
                    <h2>Filtros do Relat√≥rio</h2>
                    <div class="filters-grid">
                        <div class="form-group">
                            <label class="form-label">Entidade</label>
                            <select class="form-control" id="report-entity-filter">
                                <option value="">Todas as Entidades</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-control" id="report-status-filter">
                                <option value="">Todos os Status</option>
                                <option value="ativa">Ativa</option>
                                <option value="inativa">Inativa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor M√≠nimo</label>
                            <input type="number" class="form-control" id="report-min-value" placeholder="0,00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor M√°ximo</label>
                            <input type="number" class="form-control" id="report-max-value" placeholder="1000,00" step="0.01">
                        </div>
                    </div>
                </section>

                <!-- Report Preview -->
                <section class="section">
                    <h2>Pr√©via dos Dados</h2>
                    <div class="report-preview" id="report-preview">
                        <!-- Preview will be populated here -->
                    </div>
                </section>
            </div>

            <!-- Settings Page -->
            <div class="page hidden" id="settings-page">
                <header class="page-header">
                    <h1>Configura√ß√µes</h1>
                    <p>Configura√ß√µes do sistema e conex√£o com banco de dados</p>
                </header>

                <div class="settings-grid">
                    <div class="card">
                        <div class="card__header">
                            <h3>üîó Configura√ß√£o de Conex√£o</h3>
                        </div>
                        <div class="card__body">
                            <form id="db-config-form">
                                <div class="form-group">
                                    <label class="form-label">Database URL Completa (PostgreSQL)</label>
                                    <textarea class="form-control" id="database-url" rows="3" 
                                              placeholder="postgresql://usuario:senha@host:porta/database?parametros">postgresql://neondb_owner:npg_rLH8DGJBsfk2@ep-holy-firefly-acnw4zp1-pooler.sa-east-1.aws.neon.tech/linhas_db?sslmode=require&channel_binding=require</textarea>
                                    <small class="form-help">Cole a URL completa de conex√£o com o NeonTech</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">API Base URL</label>
                                    <input type="text" class="form-control" id="api-base-url" 
                                           value="/.netlify/functions/api"
                                           placeholder="http://localhost:8888/.netlify/functions/api">
                                    <small class="form-help">URL base da API (adapta-se automaticamente para produ√ß√£o)</small>
                                </div>
                                <div class="connection-test-results" id="connection-test-results">
                               
                                    <!-- Test results will appear here -->
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn--outline" id="test-connection-btn">
                                        üîó Testar Conex√£o Completa
                                    </button>
                                    <button type="submit" class="btn btn--primary">
                                        üíæ Salvar Configura√ß√µes
                                    </button>
                                    <button type="button" class="btn btn--secondary" id="reset-config-btn">
                                        üîÑ Restaurar Padr√£o
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>üîß Configura√ß√µes Avan√ßadas</h3>
                        </div>
                        <div class="card__body">
                            <div class="form-group">
                                <label class="form-label">Modo de Opera√ß√£o</label>
                                <select class="form-control" id="operation-mode">
                                    <option value="online">Online (com banco de dados)</option>
                                    <option value="offline">Offline (dados locais)</option>
                                    <option value="fallback">Fallback autom√°tico</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tentativas de Reconex√£o</label>
                                <input type="number" class="form-control" id="retry-attempts" value="3" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Intervalo de Retry (segundos)</label>
                                <input type="number" class="form-control" id="retry-delay" value="2" min="1" max="30">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Auto-refresh (segundos)</label>
                                <input type="number" class="form-control" id="auto-refresh" value="30" min="10" max="300">
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="enable-debug" checked> 
                                    Habilitar modo debug (logs detalhados)
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="show-notifications" checked> 
                                    Mostrar notifica√ß√µes
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>üìä Status do Sistema</h3>
                        </div>
                        <div class="card__body">
                            <div class="system-info">
                                <div class="info-item">
                                    <span class="info-label">Vers√£o:</span>
                                    <span class="info-value">1.0.0-corrigida</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Status da Conex√£o:</span>
                                    <span class="info-value status-indicator-text" id="detailed-connection-status">Verificando...</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">√öltima Sincroniza√ß√£o:</span>
                                    <span class="info-value" id="last-sync">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Registros Locais:</span>
                                    <span class="info-value" id="local-record-count">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">√öltima Tentativa de API:</span>
                                    <span class="info-value" id="last-api-attempt">Nunca</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Opera√ß√µes Pendentes:</span>
                                    <span class="info-value" id="pending-operations">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Debug Console -->
                    <div class="card">
                        <div class="card__header">
                            <h3>üêõ Console de Debug</h3>
                        </div>
                        <div class="card__body">
                            <div class="debug-console" id="debug-console">
                                <div class="debug-log">Aguardando logs...</div>
                            </div>
                            <div class="debug-actions">
                                <button class="btn btn--sm btn--outline" id="clear-debug">
                                    üóëÔ∏è Limpar Console
                                </button>
                                <button class="btn btn--sm btn--secondary" id="download-logs">
                                    üì• Baixar Logs
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Line Modal -->
    <div class="modal hidden" id="line-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Adicionar Linha</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="line-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Titular *</label>
                            <input type="text" class="form-control" id="titular" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">N√∫mero do Celular *</label>
                            <input type="Tel" class="form-control" id="numerocelular" required placeholder="(11) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor Mensal *</label>
                            <input type="number" step="0.01" class="form-control" id="valor" required placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Plano *</label>
                            <select class="form-control" id="plano" required>
                                <option value="">Selecione um plano</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Respons√°vel *</label>
                            <input type="text" class="form-control" id="responsavel" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">C√≥digo do Respons√°vel *</label>
                            <input type="text" class="form-control" id="codigoresponsavel" required placeholder="RES001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Conta Cont√°bil *</label>
                            <input type="text" class="form-control" id="contacontabil" required placeholder="1.2.3.4.001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Centro de Custo *</label>
                            <select class="form-control" id="centrocusto" required>
                                <option value="">Selecione um centro de custo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Entidade *</label>
                            <select class="form-control" id="entidade" required>
                                <option value="">Selecione uma entidade</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status *</label>
                            <select class="form-control" id="status" required>
                                <option value="ativa">Ativa</option>
                                <option value="inativa">Inativa</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--outline" id="cancel-btn">Cancelar</button>
                <button type="submit" form="line-form" class="btn btn--primary" id="save-btn">
                    <span id="save-btn-text">Salvar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Overlay -->
   <!--  <div id="loading-overlay" class="loading-overlay"> -->
  <!--  <div class="loading-spinner"></div> -->
  <!--  <div class="loading-text">Carregando‚Ä¶</div> -->
 <!-- </div> -->

    <script src="app.js"></script>
</body>
</html>
